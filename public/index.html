<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>SF Bay Area Food Trucks</title>
  <meta name="description" content="Find you favorite Food Trucks!">
  <meta name="author" content="SitePoint">
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.css' rel='stylesheet' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>

<body>
  <script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.3/leaflet-heat.js'></script>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.js'></script>


  <h1> Find your favorite Food trucks below! </h1>

  <div class="events-index-wrap">
  <div id="trucklist" style="width:50% height:700px "></div>

  <div id="mapid" style="position: relative; overflow: hidden; background-color: rgb(229, 227, 223); width:50%; height: 600px"></div>

  <script>      

  // detect zipcode and set the view to that 
  // also give the option to enter zip code
  // update map to that location long/lat

  $(document).ready(function() {

      // map access
      L.map.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw'

      // initialize map
      var mymap = L.map('mapid').setView([37.7749, -122.4194], 12); 

      // mapbox api
      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
          '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
          'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
        id: 'mapbox.streets'
      }).addTo(mymap);

      var address = "94107"; // input the address from user
      var lat;
      var lng;

      // get the lat/long for address, zipcode, city
      $.ajax({
        url: "http://maps.googleapis.com/maps/api/geocode/json?address="+address+"&sensor=false",
        type: "POST",
        success: function(res){
           lat=res.results[0].geometry.location.lat;
           lng=res.results[0].geometry.location.lng;
        
           $.ajax({
            url: "/geodata",
            data: {'lat':lat,'lng':lng},
            type: "POST",
            success: function(result) {
                if ( typeof result == "string") {
                    console.log("helo");
                 } else {
                    var foodtrucks = result;
                 }
            }
          }); 
        }
      });
      
  });
  </script>
</body>
</html>
